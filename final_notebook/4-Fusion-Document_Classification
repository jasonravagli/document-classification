{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"name":"4-Fusion-Document_Classification","provenance":[],"collapsed_sections":[],"toc_visible":true},"kernelspec":{"name":"python3","display_name":"Python 3"},"accelerator":"GPU","widgets":{"application/vnd.jupyter.widget-state+json":{"c5cd47340b1e4df5a30dde5fc9aa1212":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_ab259e0528e8493aacde5eb2c525a8ca","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_15edac5ae2a4457d972cdd03583120b8","IPY_MODEL_ea31231210eb4d18af9ad04e0dd4c51a"]}},"ab259e0528e8493aacde5eb2c525a8ca":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"15edac5ae2a4457d972cdd03583120b8":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","state":{"_view_name":"ProgressView","style":"IPY_MODEL_8a0886272a924ff68ad66d25aab5c9d5","_dom_classes":[],"description":"100%","_model_name":"FloatProgressModel","bar_style":"success","max":553507836,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":553507836,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_c43f26859b9b4103b9978856c56195d0"}},"ea31231210eb4d18af9ad04e0dd4c51a":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","state":{"_view_name":"HTMLView","style":"IPY_MODEL_89669300d39c406d85de74b94ad7a139","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 528M/528M [00:19&lt;00:00, 28.2MB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_eeb5eed8b53f43748695a1fe331aaa9a"}},"8a0886272a924ff68ad66d25aab5c9d5":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"initial","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"c43f26859b9b4103b9978856c56195d0":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"89669300d39c406d85de74b94ad7a139":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"eeb5eed8b53f43748695a1fe331aaa9a":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}}}}},"cells":[{"cell_type":"markdown","metadata":{"id":"u-pfXw83ZF9V","colab_type":"text"},"source":["# Setup\n","\n","\n","> Import libraries\n","\n","> Import Drive\n","\n","\n"]},{"cell_type":"code","metadata":{"id":"755J3fS5Y7Ec","colab_type":"code","outputId":"1ed7d6fa-eea2-4927-8027-7058038736a1","executionInfo":{"status":"ok","timestamp":1589707417810,"user_tz":-120,"elapsed":145000,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":306}},"source":["!pip install \"torch==1.4\" \"torchvision==0.5.0\""],"execution_count":0,"outputs":[{"output_type":"stream","text":["Collecting torch==1.4\n","\u001b[?25l  Downloading https://files.pythonhosted.org/packages/24/19/4804aea17cd136f1705a5e98a00618cb8f6ccc375ad8bfa437408e09d058/torch-1.4.0-cp36-cp36m-manylinux1_x86_64.whl (753.4MB)\n","\u001b[K     |████████████████████████████████| 753.4MB 21kB/s \n","\u001b[?25hCollecting torchvision==0.5.0\n","\u001b[?25l  Downloading https://files.pythonhosted.org/packages/7e/90/6141bf41f5655c78e24f40f710fdd4f8a8aff6c8b7c6f0328240f649bdbe/torchvision-0.5.0-cp36-cp36m-manylinux1_x86_64.whl (4.0MB)\n","\u001b[K     |████████████████████████████████| 4.0MB 48.1MB/s \n","\u001b[?25hRequirement already satisfied: pillow>=4.1.1 in /usr/local/lib/python3.6/dist-packages (from torchvision==0.5.0) (7.0.0)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.6/dist-packages (from torchvision==0.5.0) (1.18.4)\n","Requirement already satisfied: six in /usr/local/lib/python3.6/dist-packages (from torchvision==0.5.0) (1.12.0)\n","Installing collected packages: torch, torchvision\n","  Found existing installation: torch 1.5.0+cu101\n","    Uninstalling torch-1.5.0+cu101:\n","      Successfully uninstalled torch-1.5.0+cu101\n","  Found existing installation: torchvision 0.6.0+cu101\n","    Uninstalling torchvision-0.6.0+cu101:\n","      Successfully uninstalled torchvision-0.6.0+cu101\n","Successfully installed torch-1.4.0 torchvision-0.5.0\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"57Y7UvGDZc-q","colab_type":"code","colab":{}},"source":["import pandas as pd\n","import numpy as np\n","import io\n","import os\n","\n","from tqdm import tqdm\n","\n","import fastai\n","from fastai import *\n","from fastai.text import * \n","from functools import partial\n","from fastai.vision import *\n","from fastai.metrics import error_rate\n","\n","import h5py\n","import numpy as np\n","import pandas as pd\n","import cv2\n","from tqdm import tqdm\n","from fastai.callbacks import EarlyStoppingCallback, SaveModelCallback\n","from fastai.metrics import error_rate\n","\n","# Google Drive\n","from pydrive.auth import GoogleAuth\n","from pydrive.drive import GoogleDrive\n","from google.colab import auth, drive\n","from oauth2client.client import GoogleCredentials\n","from google.colab import drive"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"8f_eNXQgZf6S","colab_type":"text"},"source":["Google Drive"]},{"cell_type":"code","metadata":{"id":"5U4qYrxteh7r","colab_type":"code","outputId":"d27bc649-fb2b-420e-b904-efe270c2c0fe","executionInfo":{"status":"ok","timestamp":1589708974376,"user_tz":-120,"elapsed":1701516,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":122}},"source":["# auth.authenticate_user()\n","# gauth = GoogleAuth()\n","# gauth.credentials = GoogleCredentials.get_application_default()\n","# GoogleDrive(gauth)\n","drive.mount(\"/content/drive\")"],"execution_count":0,"outputs":[{"output_type":"stream","text":["Go to this URL in a browser: https://accounts.google.com/o/oauth2/auth?client_id=947318989803-6bn6qk8qdgf4n4g3pfee6491hc0brc4i.apps.googleusercontent.com&redirect_uri=urn%3aietf%3awg%3aoauth%3a2.0%3aoob&response_type=code&scope=email%20https%3a%2f%2fwww.googleapis.com%2fauth%2fdocs.test%20https%3a%2f%2fwww.googleapis.com%2fauth%2fdrive%20https%3a%2f%2fwww.googleapis.com%2fauth%2fdrive.photos.readonly%20https%3a%2f%2fwww.googleapis.com%2fauth%2fpeopleapi.readonly\n","\n","Enter your authorization code:\n","··········\n","Mounted at /content/drive\n"],"name":"stdout"}]},{"cell_type":"markdown","metadata":{"id":"qJRSsk-iZmcF","colab_type":"text"},"source":["General parameters and settings"]},{"cell_type":"code","metadata":{"id":"G3JEBf1fZn9R","colab_type":"code","colab":{}},"source":["input_models_folder = \"/content/drive/My Drive/document-classification/models/final-models/\"\n","output_models_folder = \"/content/drive/My Drive/document-classification/models/feature-fusion\"\n","dataset_path = \"/content/drive/My Drive/document-classification/datasets/rvl-cdip/mini-dataset-1488-288-192\"\n","\n","path_train_ocr = os.path.join(dataset_path, 'train_extracted.csv')\n","path_test_ocr = os.path.join(dataset_path, 'test_extracted.csv')\n","path_valid_ocr = os.path.join(dataset_path, 'valid_extracted.csv')\n","\n","# Shape of the images in input to the CNN\n","cnn_image_shape = (224, 224)\n","# Number of images classes\n","n_classes = 16\n","# Batch size to be used in training\n","batch_size = 32"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"5Rc3YUhvaOr1","colab_type":"text"},"source":["# Input Models"]},{"cell_type":"markdown","metadata":{"id":"BDTHjQ6Sh0E3","colab_type":"text"},"source":["Load the VGG model (image classification) and the LSTM based model (text classification) trained in the previous notebooks."]},{"cell_type":"markdown","metadata":{"id":"hoEMGzlfaui0","colab_type":"text"},"source":["## VGG Model"]},{"cell_type":"markdown","metadata":{"id":"VARXe8_0bJGj","colab_type":"text"},"source":["### Data"]},{"cell_type":"code","metadata":{"id":"p-fxMdzpDdgF","colab_type":"code","outputId":"e24fac85-4b4b-42a1-ebde-6490415199ce","executionInfo":{"status":"ok","timestamp":1589709031427,"user_tz":-120,"elapsed":1758524,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":221}},"source":["df_train = pd.read_csv(os.path.join(dataset_path, \"train-labels.csv\"), names=[\"image\", \"label\"])\n","df_valid = pd.read_csv(os.path.join(dataset_path, \"valid-labels.csv\"), names=[\"image\", \"label\"])\n","df_train[\"is_valid\"] = False\n","df_valid[\"is_valid\"] = True\n","df_joined = pd.concat([df_train, df_valid], ignore_index=True)\n","print(df_joined.head())\n","print(df_joined.tail())\n","\n","data_vgg = (ImageList.from_df(df_joined, dataset_path, cols=\"image\")#, folder=mini_dataset_path)\n","        .split_from_df()\n","        .label_from_df()\n","        .transform(size=cnn_image_shape, resize_method=ResizeMethod.SQUISH)\n","        .databunch(bs=batch_size)\n","        .normalize())"],"execution_count":0,"outputs":[{"output_type":"stream","text":["                                 image  label  is_valid\n","0  train/0/0/0/0/94002065_94002066.tif     10     False\n","1         train/0/0/0/1/2074950097.tif     10     False\n","2      train/0/0/0/2/50284095-4103.tif      6     False\n","3           train/0/0/0/3/04003306.tif     10     False\n","4         train/0/0/0/4/2024967978.tif     11     False\n","                                        image  label  is_valid\n","1771             valid/0/2/8/3/0060077830.tif      7      True\n","1772             valid/0/2/8/4/2045723775.tif     15      True\n","1773  valid/0/2/8/5/2062426213_2062426237.tif     12      True\n","1774      valid/0/2/8/6/01747683_01747694.tif     13      True\n","1775               valid/0/2/8/7/10395005.tif      8      True\n"],"name":"stdout"}]},{"cell_type":"markdown","metadata":{"id":"KVjv7tE5bK28","colab_type":"text"},"source":["### Model"]},{"cell_type":"code","metadata":{"id":"Y3pUjgmoduN1","colab_type":"code","outputId":"a89e90c6-3000-40de-9c41-53d7a37f0ef3","executionInfo":{"status":"ok","timestamp":1589709052021,"user_tz":-120,"elapsed":1779082,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":1000,"referenced_widgets":["c5cd47340b1e4df5a30dde5fc9aa1212","ab259e0528e8493aacde5eb2c525a8ca","15edac5ae2a4457d972cdd03583120b8","ea31231210eb4d18af9ad04e0dd4c51a","8a0886272a924ff68ad66d25aab5c9d5","c43f26859b9b4103b9978856c56195d0","89669300d39c406d85de74b94ad7a139","eeb5eed8b53f43748695a1fe331aaa9a"]}},"source":["learn_vgg = cnn_learner(data_vgg, models.vgg16_bn, metrics=accuracy,\n","                    model_dir=input_models_folder)\n","learn_vgg.load(\"vgg16_1488-288-192_valid-acc-63.89\");\n","learn_vgg.model"],"execution_count":0,"outputs":[{"output_type":"stream","text":["Downloading: \"https://download.pytorch.org/models/vgg16_bn-6c64b313.pth\" to /root/.cache/torch/checkpoints/vgg16_bn-6c64b313.pth\n"],"name":"stderr"},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"c5cd47340b1e4df5a30dde5fc9aa1212","version_minor":0,"version_major":2},"text/plain":["HBox(children=(FloatProgress(value=0.0, max=553507836.0), HTML(value='')))"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["\n"],"name":"stdout"},{"output_type":"execute_result","data":{"text/plain":["Sequential(\n","  (0): Sequential(\n","    (0): Sequential(\n","      (0): Conv2d(3, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (1): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (2): ReLU(inplace=True)\n","      (3): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (4): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (5): ReLU(inplace=True)\n","      (6): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","      (7): Conv2d(64, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (8): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (9): ReLU(inplace=True)\n","      (10): Conv2d(128, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (11): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (12): ReLU(inplace=True)\n","      (13): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","      (14): Conv2d(128, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (15): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (16): ReLU(inplace=True)\n","      (17): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (18): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (19): ReLU(inplace=True)\n","      (20): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (21): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (22): ReLU(inplace=True)\n","      (23): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","      (24): Conv2d(256, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (25): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (26): ReLU(inplace=True)\n","      (27): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (28): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (29): ReLU(inplace=True)\n","      (30): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (31): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (32): ReLU(inplace=True)\n","      (33): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","      (34): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (35): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (36): ReLU(inplace=True)\n","      (37): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (38): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (39): ReLU(inplace=True)\n","      (40): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (41): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (42): ReLU(inplace=True)\n","      (43): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","    )\n","    (1): AdaptiveAvgPool2d(output_size=(7, 7))\n","  )\n","  (1): Sequential(\n","    (0): AdaptiveConcatPool2d(\n","      (ap): AdaptiveAvgPool2d(output_size=1)\n","      (mp): AdaptiveMaxPool2d(output_size=1)\n","    )\n","    (1): Flatten()\n","    (2): BatchNorm1d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","    (3): Dropout(p=0.25, inplace=False)\n","    (4): Linear(in_features=1024, out_features=512, bias=True)\n","    (5): ReLU(inplace=True)\n","    (6): BatchNorm1d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","    (7): Dropout(p=0.5, inplace=False)\n","    (8): Linear(in_features=512, out_features=16, bias=True)\n","  )\n",")"]},"metadata":{"tags":[]},"execution_count":6}]},{"cell_type":"markdown","metadata":{"id":"wQ5eTjJwgxnH","colab_type":"text"},"source":["Remove the final layers from the model:"]},{"cell_type":"code","metadata":{"id":"iwO-kpzmeQmd","colab_type":"code","outputId":"5460aac0-be83-421f-90d2-355718aaa463","executionInfo":{"status":"ok","timestamp":1589709052023,"user_tz":-120,"elapsed":1778988,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":1000}},"source":["learn_vgg.model[-1] = learn_vgg.model[-1][:-3] \n","learn_vgg.model"],"execution_count":0,"outputs":[{"output_type":"execute_result","data":{"text/plain":["Sequential(\n","  (0): Sequential(\n","    (0): Sequential(\n","      (0): Conv2d(3, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (1): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (2): ReLU(inplace=True)\n","      (3): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (4): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (5): ReLU(inplace=True)\n","      (6): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","      (7): Conv2d(64, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (8): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (9): ReLU(inplace=True)\n","      (10): Conv2d(128, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (11): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (12): ReLU(inplace=True)\n","      (13): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","      (14): Conv2d(128, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (15): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (16): ReLU(inplace=True)\n","      (17): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (18): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (19): ReLU(inplace=True)\n","      (20): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (21): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (22): ReLU(inplace=True)\n","      (23): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","      (24): Conv2d(256, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (25): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (26): ReLU(inplace=True)\n","      (27): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (28): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (29): ReLU(inplace=True)\n","      (30): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (31): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (32): ReLU(inplace=True)\n","      (33): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","      (34): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (35): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (36): ReLU(inplace=True)\n","      (37): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (38): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (39): ReLU(inplace=True)\n","      (40): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (41): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (42): ReLU(inplace=True)\n","      (43): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","    )\n","    (1): AdaptiveAvgPool2d(output_size=(7, 7))\n","  )\n","  (1): Sequential(\n","    (0): AdaptiveConcatPool2d(\n","      (ap): AdaptiveAvgPool2d(output_size=1)\n","      (mp): AdaptiveMaxPool2d(output_size=1)\n","    )\n","    (1): Flatten()\n","    (2): BatchNorm1d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","    (3): Dropout(p=0.25, inplace=False)\n","    (4): Linear(in_features=1024, out_features=512, bias=True)\n","    (5): ReLU(inplace=True)\n","  )\n",")"]},"metadata":{"tags":[]},"execution_count":7}]},{"cell_type":"markdown","metadata":{"id":"NLjSxjkBa9IF","colab_type":"text"},"source":["## LSTM-based Model (ULMFiT)"]},{"cell_type":"markdown","metadata":{"id":"h7Hj0jKAazs7","colab_type":"text"},"source":["### Data"]},{"cell_type":"code","metadata":{"id":"5XZ0KIAjedn8","colab_type":"code","outputId":"f4aa3105-7322-4a5f-854b-dabfdd3b1bba","executionInfo":{"status":"ok","timestamp":1589709052875,"user_tz":-120,"elapsed":1779819,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":34}},"source":["df_trn, df_val, df_test = pd.read_csv(path_train_ocr,names=['text','label']), pd.read_csv(path_valid_ocr,names=['text','label']), pd.read_csv(path_test_ocr,names=['text','label'])\n","print(df_trn.shape, df_val.shape, df_test.shape)"],"execution_count":0,"outputs":[{"output_type":"stream","text":["(1488, 2) (288, 2) (192, 2)\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"_XSuZDp1exH0","colab_type":"code","outputId":"2ea0c4b6-5ffc-4623-a1df-2ce7091dfb18","executionInfo":{"status":"ok","timestamp":1589709061647,"user_tz":-120,"elapsed":1788515,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":17}},"source":["# Language model data\n","data_lm = TextLMDataBunch.from_df(train_df = df_trn, valid_df = df_val, path = \"\",\n","                                  text_cols=\"text\", label_cols=\"label\")\n","# Classifier model data\n","data_clas = TextClasDataBunch.from_df(path = \"\", train_df = df_trn, valid_df = df_val,\n","                                      text_cols=\"text\", label_cols=\"label\", vocab=data_lm.train_ds.vocab, bs=batch_size)"],"execution_count":0,"outputs":[{"output_type":"display_data","data":{"text/html":[""],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}},{"output_type":"display_data","data":{"text/html":[""],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}},{"output_type":"display_data","data":{"text/html":[""],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}},{"output_type":"display_data","data":{"text/html":[""],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}}]},{"cell_type":"markdown","metadata":{"id":"38p0TVX0a1tE","colab_type":"text"},"source":["### Model"]},{"cell_type":"code","metadata":{"id":"zQ5Sbfr4e4VU","colab_type":"code","outputId":"fbaa4687-be60-4ffb-a693-f83ce7a8e75b","executionInfo":{"status":"ok","timestamp":1589709073043,"user_tz":-120,"elapsed":1799879,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":680}},"source":["#learn_ocr = language_model_learner(data_lm, arch=AWD_LSTM, drop_mult=0.7, model_dir=models_folder_path)\n","\n","learn_text = text_classifier_learner(data_clas, arch=AWD_LSTM, drop_mult=0.7,\n","                                     model_dir=input_models_folder)\n","learn_text.load(\"text-class_1488-288-192_valid-acc-55.55\")\n","learn_text.model"],"execution_count":0,"outputs":[{"output_type":"stream","text":["Downloading https://s3.amazonaws.com/fast-ai-modelzoo/wt103-fwd.tgz\n"],"name":"stdout"},{"output_type":"display_data","data":{"text/html":[""],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}},{"output_type":"execute_result","data":{"text/plain":["SequentialRNN(\n","  (0): MultiBatchEncoder(\n","    (module): AWD_LSTM(\n","      (encoder): Embedding(15392, 400, padding_idx=1)\n","      (encoder_dp): EmbeddingDropout(\n","        (emb): Embedding(15392, 400, padding_idx=1)\n","      )\n","      (rnns): ModuleList(\n","        (0): WeightDropout(\n","          (module): LSTM(400, 1152, batch_first=True)\n","        )\n","        (1): WeightDropout(\n","          (module): LSTM(1152, 1152, batch_first=True)\n","        )\n","        (2): WeightDropout(\n","          (module): LSTM(1152, 400, batch_first=True)\n","        )\n","      )\n","      (input_dp): RNNDropout()\n","      (hidden_dps): ModuleList(\n","        (0): RNNDropout()\n","        (1): RNNDropout()\n","        (2): RNNDropout()\n","      )\n","    )\n","  )\n","  (1): PoolingLinearClassifier(\n","    (layers): Sequential(\n","      (0): BatchNorm1d(1200, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (1): Dropout(p=0.27999999999999997, inplace=False)\n","      (2): Linear(in_features=1200, out_features=50, bias=True)\n","      (3): ReLU(inplace=True)\n","      (4): BatchNorm1d(50, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (5): Dropout(p=0.1, inplace=False)\n","      (6): Linear(in_features=50, out_features=16, bias=True)\n","    )\n","  )\n",")"]},"metadata":{"tags":[]},"execution_count":10}]},{"cell_type":"markdown","metadata":{"id":"BpjHs2xFhBMA","colab_type":"text"},"source":["Remove the final layers from the model (according to https://gist.github.com/joshfp/b62b76eae95e6863cb511997b5a63118)"]},{"cell_type":"code","metadata":{"id":"f_ddKCxZfNzF","colab_type":"code","outputId":"2cc05025-3e99-4746-9b6f-6798937bf2ee","executionInfo":{"status":"ok","timestamp":1589709073045,"user_tz":-120,"elapsed":1799856,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":612}},"source":["learn_text.model[-1].layers = learn_text.model[-1].layers[:-3] \n","learn_text.model"],"execution_count":0,"outputs":[{"output_type":"execute_result","data":{"text/plain":["SequentialRNN(\n","  (0): MultiBatchEncoder(\n","    (module): AWD_LSTM(\n","      (encoder): Embedding(15392, 400, padding_idx=1)\n","      (encoder_dp): EmbeddingDropout(\n","        (emb): Embedding(15392, 400, padding_idx=1)\n","      )\n","      (rnns): ModuleList(\n","        (0): WeightDropout(\n","          (module): LSTM(400, 1152, batch_first=True)\n","        )\n","        (1): WeightDropout(\n","          (module): LSTM(1152, 1152, batch_first=True)\n","        )\n","        (2): WeightDropout(\n","          (module): LSTM(1152, 400, batch_first=True)\n","        )\n","      )\n","      (input_dp): RNNDropout()\n","      (hidden_dps): ModuleList(\n","        (0): RNNDropout()\n","        (1): RNNDropout()\n","        (2): RNNDropout()\n","      )\n","    )\n","  )\n","  (1): PoolingLinearClassifier(\n","    (layers): Sequential(\n","      (0): BatchNorm1d(1200, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (1): Dropout(p=0.27999999999999997, inplace=False)\n","      (2): Linear(in_features=1200, out_features=50, bias=True)\n","      (3): ReLU(inplace=True)\n","    )\n","  )\n",")"]},"metadata":{"tags":[]},"execution_count":11}]},{"cell_type":"markdown","metadata":{"id":"OAYEuveEfclc","colab_type":"text"},"source":["# Concatenated Model"]},{"cell_type":"markdown","metadata":{"id":"q5hfaaxvidMI","colab_type":"text"},"source":["Combine the two previous models into a new one. Doing this, the new model will classify using both visual and textual features."]},{"cell_type":"markdown","metadata":{"id":"aH7fKnHSnLiR","colab_type":"text"},"source":["## Data"]},{"cell_type":"markdown","metadata":{"id":"sBoo3jY5blEO","colab_type":"text"},"source":["Define a custom PyTorch Dataset to concat the two datasets (images and text).\n","\n","When an element of the Dataset is requested (\\_\\_getitem\\__ method) resize the corresponding image to the target size before returning it along with the text and the label.\n","\n","N.B.: passing an ImageList could not be memory efficient (check how fastai manage the images in ImageList). Consider passing a list of paths and loading the image in \\_\\_getItem\\_\\_"]},{"cell_type":"code","metadata":{"id":"dTtMBAWXff4k","colab_type":"code","colab":{}},"source":["# Per accedere ad alcune funzionalità di fastai è necessario definire cose aggiuntive\n","# nel Dataset\n","class ConcatDataset(Dataset):\n","    def __init__(self, x_images: ImageList, x_texts: TextList, y): \n","        self.x_images = x_images\n","        self.x_texts = x_texts\n","        self.y = y\n","\n","    def __len__(self):\n","        return len(self.y)\n","    \n","    def __getitem__(self, i):\n","        return (self.x_images[i].apply_tfms([], size=cnn_image_shape, resize_method=ResizeMethod.SQUISH),\n","                                      self.x_texts[i]), self.y[i]\n","\n","train_ds = ConcatDataset(data_vgg.train_ds.x, data_clas.train_ds.x, data_vgg.train_ds.y)\n","valid_ds = ConcatDataset(data_vgg.valid_ds.x, data_clas.valid_ds.x, data_vgg.valid_ds.y)"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"AqZH5ERoe1XH","colab_type":"text"},"source":["Define a collate function to pass to the DataBunch. This function will replace the one used by the Dataloader and describe how to collate the samples taken for a batch from the ConcatDataset."]},{"cell_type":"code","metadata":{"id":"xLv_ovjGfKhm","colab_type":"code","colab":{}},"source":["def my_collate(batch):\n","    x,y = list(zip(*batch))\n","    x1,x2 = list(zip(*x))\n","    x1 = to_data(x1)\n","    x1 = torch.stack(x1)\n","    x2, y = pad_collate(list(zip(x2, y)), pad_idx=1, pad_first=True)\n","    \n","    return (x1, x2), y"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"oDXAXxZxfgc6","colab_type":"text"},"source":["The following two cells were used in the example taken from https://gist.github.com/joshfp/b62b76eae95e6863cb511997b5a63118.\n","\n","The Sampler would allow to random sort data, but their behaviour is not clear to us.\n","We found simpler letting the DataBunch automatic creating the DataLoaders."]},{"cell_type":"code","metadata":{"id":"ofabJecQk3X4","colab_type":"code","colab":{}},"source":["# Sono dei sampler usati per dati testuali che aggiungono randomicità nella fornitura dei \n","# dati al learner (a quanto ho capito)\n","# train_sampler = SortishSampler(data_clas.train_ds.x, key=lambda t: len(data_clas.train_ds[t][0].data), bs=batch_size)\n","# valid_sampler = SortSampler(data_clas.valid_ds.x, key=lambda t: len(data_clas.valid_ds[t][0].data))"],"execution_count":0,"outputs":[]},{"cell_type":"code","metadata":{"id":"IAczzAmxk-AE","colab_type":"code","colab":{}},"source":["# train_dl = DataLoader(train_ds, batch_size, sampler=train_sampler)\n","# valid_dl = DataLoader(valid_ds, batch_size, sampler=valid_sampler)\n","\n","# data = DataBunch(train_dl, valid_dl, device=defaults.device, collate_fn=my_collate, path=dataset_path)"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"Y5soXFj4gkCY","colab_type":"text"},"source":["Create the DataBunch from the custom datasets and the collate function."]},{"cell_type":"code","metadata":{"id":"6cVrPn38gsxX","colab_type":"code","colab":{}},"source":["data = DataBunch.create(train_ds, valid_ds, collate_fn=my_collate, path=dataset_path, bs=batch_size)"],"execution_count":0,"outputs":[]},{"cell_type":"code","metadata":{"id":"0bCaaM7I1oFm","colab_type":"code","outputId":"97605780-5602-41e8-c3ba-90128233710b","executionInfo":{"status":"ok","timestamp":1589709090900,"user_tz":-120,"elapsed":1817667,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":1000}},"source":["data.one_batch()"],"execution_count":0,"outputs":[{"output_type":"execute_result","data":{"text/plain":["([tensor([[[[1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000]],\n","  \n","           [[1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000]],\n","  \n","           [[1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000]]],\n","  \n","  \n","          [[[0.9745, 0.9408, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000]],\n","  \n","           [[0.9745, 0.9408, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000]],\n","  \n","           [[0.9745, 0.9408, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000]]],\n","  \n","  \n","          [[[0.0000, 0.0000, 0.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [0.9911, 0.9884, 0.9884,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [0.7824, 0.7824, 0.7824,  ..., 1.0000, 1.0000, 1.0000]],\n","  \n","           [[0.0000, 0.0000, 0.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [0.9911, 0.9884, 0.9884,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [0.7824, 0.7824, 0.7824,  ..., 1.0000, 1.0000, 1.0000]],\n","  \n","           [[0.0000, 0.0000, 0.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [0.9911, 0.9884, 0.9884,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [0.7824, 0.7824, 0.7824,  ..., 1.0000, 1.0000, 1.0000]]],\n","  \n","  \n","          ...,\n","  \n","  \n","          [[[1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000]],\n","  \n","           [[1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000]],\n","  \n","           [[1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000]]],\n","  \n","  \n","          [[[1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000]],\n","  \n","           [[1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000]],\n","  \n","           [[1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000]]],\n","  \n","  \n","          [[[1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000]],\n","  \n","           [[1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000]],\n","  \n","           [[1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            ...,\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000],\n","            [1.0000, 1.0000, 1.0000,  ..., 1.0000, 1.0000, 1.0000]]]]),\n","  tensor([[    1,     1,     1,  ...,   363,    73,     0],\n","          [    1,     1,     1,  ...,    57,   166,     0],\n","          [    1,     1,     1,  ...,     0,  1804,   784],\n","          ...,\n","          [    1,     1,     1,  ...,   649,     0,     0],\n","          [    1,     1,     1,  ...,   102, 13361,     0],\n","          [    1,     1,     1,  ...,   143,  1848,   622]])],\n"," tensor([ 7, 15,  3, 13,  5,  7,  5,  4, 14, 10,  4,  5, 13,  6, 13, 13,  2,  0,\n","         14,  1,  0, 14, 13,  2,  9, 13,  9, 10,  7,  9,  1,  8]))"]},"metadata":{"tags":[]},"execution_count":17}]},{"cell_type":"markdown","metadata":{"id":"og60OiHIpPky","colab_type":"text"},"source":["## Model"]},{"cell_type":"markdown","metadata":{"id":"SuL4I1p-l1y7","colab_type":"text"},"source":["Define the new model taking the other two and adding linear layers at the end.\n","\n","The size of the input to the first linear layer must agree with the output of the other two models."]},{"cell_type":"code","metadata":{"id":"BU8qHKqZpUN9","colab_type":"code","colab":{}},"source":["class ConcatModel(nn.Module):\n","    def __init__(self, mod_cnn, mod_nlp, layers, drops): \n","        super().__init__()\n","        self.mod_cnn = mod_cnn\n","        self.mod_nlp = mod_nlp\n","        # Da modificare\n","        lst_layers = []\n","        activs = [nn.ReLU(inplace=True),] * (len(layers)-2) + [None]\n","        for n_in,n_out,p,actn in zip(layers[:-1], layers[1:], drops, activs):\n","            lst_layers += bn_drop_lin(n_in, n_out, p=p, actn=actn)\n","        self.layers = nn.Sequential(*lst_layers)\n","\n","    def forward(self, x_cnn, x_nlp):\n","        x_cnn = self.mod_cnn(x_cnn)\n","        # perchè [0]? Rimuovere? -> Forse perche il cat si aspetta la stessa \n","        # dimensione dei tensori lungo la dim=0 e x_nlp diventa multidim?\n","        x_nlp = self.mod_nlp(x_nlp)[0]\n","        x = torch.cat([x_cnn, x_nlp], dim=1)\n","        return self.layers(x)    "],"execution_count":0,"outputs":[]},{"cell_type":"code","metadata":{"id":"R4vp27FipbbE","colab_type":"code","outputId":"83729545-6774-4e79-f84e-56239d7c3789","executionInfo":{"status":"ok","timestamp":1589709090904,"user_tz":-120,"elapsed":1817644,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":1000}},"source":["lin_layers = [512+50, 16]\n","ps = [0.8]\n","model = ConcatModel(learn_vgg.model, learn_text.model, lin_layers, ps)\n","model"],"execution_count":0,"outputs":[{"output_type":"execute_result","data":{"text/plain":["ConcatModel(\n","  (mod_cnn): Sequential(\n","    (0): Sequential(\n","      (0): Sequential(\n","        (0): Conv2d(3, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","        (1): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","        (2): ReLU(inplace=True)\n","        (3): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","        (4): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","        (5): ReLU(inplace=True)\n","        (6): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","        (7): Conv2d(64, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","        (8): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","        (9): ReLU(inplace=True)\n","        (10): Conv2d(128, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","        (11): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","        (12): ReLU(inplace=True)\n","        (13): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","        (14): Conv2d(128, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","        (15): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","        (16): ReLU(inplace=True)\n","        (17): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","        (18): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","        (19): ReLU(inplace=True)\n","        (20): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","        (21): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","        (22): ReLU(inplace=True)\n","        (23): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","        (24): Conv2d(256, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","        (25): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","        (26): ReLU(inplace=True)\n","        (27): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","        (28): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","        (29): ReLU(inplace=True)\n","        (30): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","        (31): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","        (32): ReLU(inplace=True)\n","        (33): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","        (34): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","        (35): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","        (36): ReLU(inplace=True)\n","        (37): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","        (38): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","        (39): ReLU(inplace=True)\n","        (40): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","        (41): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","        (42): ReLU(inplace=True)\n","        (43): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","      )\n","      (1): AdaptiveAvgPool2d(output_size=(7, 7))\n","    )\n","    (1): Sequential(\n","      (0): AdaptiveConcatPool2d(\n","        (ap): AdaptiveAvgPool2d(output_size=1)\n","        (mp): AdaptiveMaxPool2d(output_size=1)\n","      )\n","      (1): Flatten()\n","      (2): BatchNorm1d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (3): Dropout(p=0.25, inplace=False)\n","      (4): Linear(in_features=1024, out_features=512, bias=True)\n","      (5): ReLU(inplace=True)\n","    )\n","  )\n","  (mod_nlp): SequentialRNN(\n","    (0): MultiBatchEncoder(\n","      (module): AWD_LSTM(\n","        (encoder): Embedding(15392, 400, padding_idx=1)\n","        (encoder_dp): EmbeddingDropout(\n","          (emb): Embedding(15392, 400, padding_idx=1)\n","        )\n","        (rnns): ModuleList(\n","          (0): WeightDropout(\n","            (module): LSTM(400, 1152, batch_first=True)\n","          )\n","          (1): WeightDropout(\n","            (module): LSTM(1152, 1152, batch_first=True)\n","          )\n","          (2): WeightDropout(\n","            (module): LSTM(1152, 400, batch_first=True)\n","          )\n","        )\n","        (input_dp): RNNDropout()\n","        (hidden_dps): ModuleList(\n","          (0): RNNDropout()\n","          (1): RNNDropout()\n","          (2): RNNDropout()\n","        )\n","      )\n","    )\n","    (1): PoolingLinearClassifier(\n","      (layers): Sequential(\n","        (0): BatchNorm1d(1200, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","        (1): Dropout(p=0.27999999999999997, inplace=False)\n","        (2): Linear(in_features=1200, out_features=50, bias=True)\n","        (3): ReLU(inplace=True)\n","      )\n","    )\n","  )\n","  (layers): Sequential(\n","    (0): BatchNorm1d(562, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","    (1): Dropout(p=0.8, inplace=False)\n","    (2): Linear(in_features=562, out_features=16, bias=True)\n","  )\n",")"]},"metadata":{"tags":[]},"execution_count":19}]},{"cell_type":"markdown","metadata":{"id":"ofNKNyU6qLm5","colab_type":"text"},"source":["## Learner"]},{"cell_type":"code","metadata":{"id":"EsO0RZXRnjOq","colab_type":"code","outputId":"a209b34d-ea41-4c2d-f66e-ef59a5078865","executionInfo":{"status":"ok","timestamp":1589709090905,"user_tz":-120,"elapsed":1817624,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":51}},"source":["print(len(learn_text.layer_groups))\n","print(len(learn_vgg.layer_groups))"],"execution_count":0,"outputs":[{"output_type":"stream","text":["5\n","3\n"],"name":"stdout"}]},{"cell_type":"code","metadata":{"id":"VailNOCcZseh","colab_type":"code","outputId":"d88e6405-3c68-48c9-e24c-2032a22f621a","executionInfo":{"status":"ok","timestamp":1589709090906,"user_tz":-120,"elapsed":1817600,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":1000}},"source":["learn_vgg.model"],"execution_count":0,"outputs":[{"output_type":"execute_result","data":{"text/plain":["Sequential(\n","  (0): Sequential(\n","    (0): Sequential(\n","      (0): Conv2d(3, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (1): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (2): ReLU(inplace=True)\n","      (3): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (4): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (5): ReLU(inplace=True)\n","      (6): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","      (7): Conv2d(64, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (8): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (9): ReLU(inplace=True)\n","      (10): Conv2d(128, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (11): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (12): ReLU(inplace=True)\n","      (13): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","      (14): Conv2d(128, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (15): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (16): ReLU(inplace=True)\n","      (17): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (18): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (19): ReLU(inplace=True)\n","      (20): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (21): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (22): ReLU(inplace=True)\n","      (23): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","      (24): Conv2d(256, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (25): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (26): ReLU(inplace=True)\n","      (27): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (28): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (29): ReLU(inplace=True)\n","      (30): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (31): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (32): ReLU(inplace=True)\n","      (33): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","      (34): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (35): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (36): ReLU(inplace=True)\n","      (37): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (38): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (39): ReLU(inplace=True)\n","      (40): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","      (41): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","      (42): ReLU(inplace=True)\n","      (43): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","    )\n","    (1): AdaptiveAvgPool2d(output_size=(7, 7))\n","  )\n","  (1): Sequential(\n","    (0): AdaptiveConcatPool2d(\n","      (ap): AdaptiveAvgPool2d(output_size=1)\n","      (mp): AdaptiveMaxPool2d(output_size=1)\n","    )\n","    (1): Flatten()\n","    (2): BatchNorm1d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","    (3): Dropout(p=0.25, inplace=False)\n","    (4): Linear(in_features=1024, out_features=512, bias=True)\n","    (5): ReLU(inplace=True)\n","  )\n",")"]},"metadata":{"tags":[]},"execution_count":21}]},{"cell_type":"code","metadata":{"id":"KHq3iYh0ZPq4","colab_type":"code","outputId":"16968d6d-bf88-4039-cc80-c420c8cd2ae0","executionInfo":{"status":"ok","timestamp":1589709090908,"user_tz":-120,"elapsed":1817581,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":1000}},"source":["learn_vgg.layer_groups"],"execution_count":0,"outputs":[{"output_type":"execute_result","data":{"text/plain":["[Sequential(\n","   (0): Conv2d(3, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","   (1): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","   (2): ReLU(inplace=True)\n","   (3): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","   (4): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","   (5): ReLU(inplace=True)\n","   (6): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","   (7): Conv2d(64, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","   (8): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","   (9): ReLU(inplace=True)\n","   (10): Conv2d(128, 128, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","   (11): BatchNorm2d(128, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","   (12): ReLU(inplace=True)\n","   (13): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","   (14): Conv2d(128, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","   (15): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","   (16): ReLU(inplace=True)\n","   (17): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","   (18): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","   (19): ReLU(inplace=True)\n","   (20): Conv2d(256, 256, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","   (21): BatchNorm2d(256, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n"," ), Sequential(\n","   (0): ReLU(inplace=True)\n","   (1): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","   (2): Conv2d(256, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","   (3): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","   (4): ReLU(inplace=True)\n","   (5): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","   (6): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","   (7): ReLU(inplace=True)\n","   (8): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","   (9): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","   (10): ReLU(inplace=True)\n","   (11): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","   (12): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","   (13): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","   (14): ReLU(inplace=True)\n","   (15): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","   (16): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","   (17): ReLU(inplace=True)\n","   (18): Conv2d(512, 512, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1))\n","   (19): BatchNorm2d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","   (20): ReLU(inplace=True)\n","   (21): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n","   (22): AdaptiveAvgPool2d(output_size=(7, 7))\n"," ), Sequential(\n","   (0): AdaptiveAvgPool2d(output_size=1)\n","   (1): AdaptiveMaxPool2d(output_size=1)\n","   (2): Flatten()\n","   (3): BatchNorm1d(1024, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","   (4): Dropout(p=0.25, inplace=False)\n","   (5): Linear(in_features=1024, out_features=512, bias=True)\n","   (6): ReLU(inplace=True)\n","   (7): BatchNorm1d(512, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)\n","   (8): Dropout(p=0.5, inplace=False)\n","   (9): Linear(in_features=512, out_features=16, bias=True)\n"," )]"]},"metadata":{"tags":[]},"execution_count":22}]},{"cell_type":"markdown","metadata":{"id":"Ld4gb5R5c6bT","colab_type":"text"},"source":["Define layer groups for the new model. Reuse the two other models layer groups and add a group with the new final layers.\n","\n","N.B. Separate the CNN linear layers from the last convolutional section into a new group (Do it in the notebook 2)"]},{"cell_type":"code","metadata":{"id":"OhHhmmX9qRWl","colab_type":"code","colab":{}},"source":["loss_func = nn.CrossEntropyLoss()\n","# Serve per il discriminative layer training -> serve per dare learning rates diversi\n","# ad ogni gruppo\n","# Approfondire quali layer appartengono ai gruppi\n","layer_groups = [nn.Sequential(*flatten_model(learn_text.layer_groups[0])),\n","                nn.Sequential(*flatten_model(learn_text.layer_groups[1])),\n","                nn.Sequential(*(flatten_model(learn_text.layer_groups[2]) + \n","                                flatten_model(learn_vgg.layer_groups[0]))),\n","                nn.Sequential(*(flatten_model(learn_text.layer_groups[3]) + \n","                                flatten_model(learn_vgg.layer_groups[1]))),\n","                nn.Sequential(*(flatten_model(learn_text.layer_groups[4]) + \n","                                flatten_model(learn_vgg.layer_groups[2]))),\n","                nn.Sequential(*flatten_model(model.layers))]\n","\n","learn = Learner(data, model, loss_func=loss_func, metrics=accuracy, layer_groups=layer_groups,\n","                path=output_models_folder)"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"tizW_P_AqQc9","colab_type":"text"},"source":["# Training"]},{"cell_type":"code","metadata":{"id":"vViMd6Q5o8Ir","colab_type":"code","colab":{}},"source":["# Congela tutti i gruppi di layer in layer_groups tranne nell'ultimo (i fully connected)\n","learn.freeze()\n","# learn.summary() -> non funziona per via del custom dataset"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"XG5YUZUKnh4y","colab_type":"text"},"source":["Find the best learning rate studying its trend (Experimental).\n","\n","This function has been taken from this post: https://forums.fast.ai/t/automated-learning-rate-suggester/44199"]},{"cell_type":"code","metadata":{"id":"2SF2uu12nv2K","colab_type":"code","outputId":"45aac464-5a3c-4615-eaa3-96cd54e45ac3","executionInfo":{"status":"ok","timestamp":1589668833425,"user_tz":-120,"elapsed":340964,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":684}},"source":["def find_appropriate_lr(model:Learner, lr_diff:int = 15, loss_threshold:float = .05, adjust_value:float = 1, plot:bool = False) -> float:\n","    #Run the Learning Rate Finder\n","    model.lr_find()\n","    \n","    #Get loss values and their corresponding gradients, and get lr values\n","    losses = np.array(model.recorder.losses)\n","    assert(lr_diff < len(losses))\n","    loss_grad = np.gradient(losses)\n","    lrs = model.recorder.lrs\n","    \n","    #Search for index in gradients where loss is lowest before the loss spike\n","    #Initialize right and left idx using the lr_diff as a spacing unit\n","    #Set the local min lr as -1 to signify if threshold is too low\n","    r_idx = -1\n","    l_idx = r_idx - lr_diff\n","    while (l_idx >= -len(losses)) and (abs(loss_grad[r_idx] - loss_grad[l_idx]) > loss_threshold):\n","        local_min_lr = lrs[l_idx]\n","        r_idx -= 1\n","        l_idx -= 1\n","\n","    lr_to_use = local_min_lr * adjust_value\n","    \n","    if plot:\n","        # plots the gradients of the losses in respect to the learning rate change\n","        plt.plot(loss_grad)\n","        plt.plot(len(losses)+l_idx, loss_grad[l_idx],markersize=10,marker='o',color='red')\n","        plt.ylabel(\"Loss\")\n","        plt.xlabel(\"Index of LRs\")\n","        plt.show()\n","\n","        plt.plot(np.log10(lrs), losses)\n","        plt.ylabel(\"Loss\")\n","        plt.xlabel(\"Log 10 Transform of Learning Rate\")\n","        loss_coord = np.interp(np.log10(lr_to_use), np.log10(lrs), losses)\n","        plt.plot(np.log10(lr_to_use), loss_coord, markersize=10,marker='o',color='red')\n","        plt.show()\n","        \n","    return lr_to_use\n","\n","learning_rate = find_appropriate_lr(learn, plot=True)\n","print(f\"Learning rate: {learning_rate}\")"],"execution_count":0,"outputs":[{"output_type":"display_data","data":{"text/html":["\n","    <div>\n","        <style>\n","            /* Turns off some styling */\n","            progress {\n","                /* gets rid of default border in Firefox and Opera. */\n","                border: none;\n","                /* Needs to be in here for Safari polyfill so background images work as expected. */\n","                background-size: auto;\n","            }\n","            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {\n","                background: #F44336;\n","            }\n","        </style>\n","      <progress value='1' class='' max='3' style='width:300px; height:20px; vertical-align: middle;'></progress>\n","      33.33% [1/3 04:59<09:59]\n","    </div>\n","    \n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: left;\">\n","      <th>epoch</th>\n","      <th>train_loss</th>\n","      <th>valid_loss</th>\n","      <th>accuracy</th>\n","      <th>time</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <td>0</td>\n","      <td>3.510786</td>\n","      <td>#na#</td>\n","      <td>04:59</td>\n","    </tr>\n","  </tbody>\n","</table><p>\n","\n","    <div>\n","        <style>\n","            /* Turns off some styling */\n","            progress {\n","                /* gets rid of default border in Firefox and Opera. */\n","                border: none;\n","                /* Needs to be in here for Safari polyfill so background images work as expected. */\n","                background-size: auto;\n","            }\n","            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {\n","                background: #F44336;\n","            }\n","        </style>\n","      <progress value='41' class='' max='46' style='width:300px; height:20px; vertical-align: middle;'></progress>\n","      89.13% [41/46 00:36<00:04 9.1997]\n","    </div>\n","    "],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["LR Finder is complete, type {learner_name}.recorder.plot() to see the graph.\n"],"name":"stdout"},{"output_type":"display_data","data":{"image/png":"iVBORw0KGgoAAAANSUhEUgAAAYIAAAEGCAYAAABo25JHAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4yLjEsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+j8jraAAAgAElEQVR4nO3deXxc5X3v8c9vpNG+WZa8ybsxUINtwI4JIWlJ0gRIGmgTGkiBktymvu0NDeTSJeS26Xb7uslNm4Y0ISkFQsjSpCVN4tuSPSSEhATkBdssBu+WV0mjfSTN9rt/zMgRRhYy1syZ0fm+X695WWfmzJmfDof56jnPeZ5j7o6IiIRXJOgCREQkWAoCEZGQUxCIiIScgkBEJOQUBCIiIVcedAFnqqWlxZcuXRp0GSIiJWXz5s1d7t460WslFwRLly6lvb096DJEREqKmR043Ws6NSQiEnIKAhGRkFMQiIiEnIJARCTkFAQiIiGnIBARCTkFgYhIyCkIRERKwF3ff4HHXujKy7YVBCIiRW5wNMUnfvA87Qdiedm+gkBEpMjtPNyHO6xd2JSX7SsIRESK3PaOXgDWLGzMy/YVBCIiRW57Rx9tTdXMrqvMy/YVBCIiRW57Rx9rF+WnNQAKAhGRotYzlOBgLM7qtvz0D4CCQESkqG0/3AfA2jz1D4CCQESkqG0/lO0ovlBBICISTtsP97G8tZaGqmjePkNBICJSxLZ39OZt/MAYBYGISJE63j/C8f7RvI0fGKMgEBEpUk8dyu9AsjEKAhGRIrW9o4+yiLFqvoJARCSUth/u49y59VRXlOX1cxQEIiJFyN1zHcX5bQ1AHoPAzBaZ2SNm9oyZPW1mt02wjpnZJ81st5ltN7NL8lWPiEgpORQbpjeeZE2erxgCKM/jtlPAHe6+xczqgc1m9j13f2bcOlcDK3OPS4HP5P4VEQm1p/I84+h4eWsRuPtRd9+S+3kAeBZoO2W1a4EHPevnQJOZzc9XTSIipWJP5yAA586tz/tnFaSPwMyWAhcDvzjlpTbg0LjlDl4aFpjZRjNrN7P2zs7OfJUpIlI0YkMJGqujVJTn/2s6759gZnXA14Db3b3/lWzD3e9x9/Xuvr61tXV6CxQRKULdQwlm11YU5LPyGgRmFiUbAl9y9/+YYJXDwKJxywtzz4mIhFpsMEFzqQeBmRlwH/Csu3/8NKttAn43d/XQq4E+dz+ar5pEREpFbCjBrAIFQT6vGrocuBnYYWbbcs99CFgM4O6fBR4G3gLsBuLAe/JYj4hIyYjFE1y8OP+XjkIeg8DdHwPsZdZx4H35qkFEpBS5Oz1DM+DUkIiIvDL9wylSGVcQiIiEVffQKACz6xQEIiKhFBtKADCrRkEgIhJKY0Ewu7ayIJ+nIBARKTJjQdCsU0MiIuHUfbJFoCAQEQml2FCCmooyqqL5vSHNGAWBiEiRiRVwDAEoCEREio6CQEQk5BQEIiIhpyAQEQm57qHRgl0xBAoCEZGiEk+kGElmaC7QYDJQEIiIFJWTg8lqowX7TAWBiEgR+WUQqEUgIhJK3SeDQH0EIiKhFBss7PQSoCAQESkqhZ5wDhQEIiJFJRZPEC0z6ivzeUv5F1MQiIgUkdhgglk1FZhNesv3aaUgEBEpIt0FHlUMCgIRkaISGxot2L2KxygIRESKSHaeocKNIQAFgYhIUYkNJQp66SgoCEREikYynaF/JMWsGgWBiEgo9QQwhgAUBCIiRaPQN60foyAQESkSsQDmGQIFgYhI0YipRSAiEm5qEYiIhFz3UAIzaNJVQyIi4RQbGqWpOkpZpHDzDEEeg8DM7jezE2a28zSvX2FmfWa2Lff4cL5qEREpBbEA5hkCyOc8pw8AnwIenGSdn7j7b+SxBhGRkpEdVVzY6SUgjy0Cd38UiOVr+yIiM01QLYKg+wguM7OnzOxbZnbB6VYys41m1m5m7Z2dnYWsT0SkYGJDCWaFLAi2AEvcfS3wT8A3Treiu9/j7uvdfX1ra2vBChQRKZRMxumJJws+hgACDAJ373f3wdzPDwNRM2sJqh4RkSD1DidJZ5yWAs8zBAEGgZnNs9y92MxsQ66W7qDqEREJUvfgKACz6wrfWZy3q4bM7F+BK4AWM+sA/hKIArj7Z4HrgD80sxQwDNzg7p6vekREilnXYG56iQBaBHkLAnd/18u8/imyl5eKiIRe91C2RdASQIsg6KuGREQE6BpQEIiIhFr3UIKIQVN1tOCfrSAQESkCXYPZm9ZHCjzPECgIRESKQvfgaCCXjoKCQESkKHQPJQK5YggUBCIiRaF7cDSQCedAQSAiUhS6B9UiEBEJrZFkmoHRVCCXjoKCQEQkcN0B3bR+jIJARCRgY/MMqUUgIhJS3QHOMwQKAhGRwHWpRSAiEm4n+wjUIhARCaeugVGqo2XUVORtQuhJKQhERAIW5KhiUBCIiASua3A0kDuTjVEQiIgErHswQUtAYwhAQSAiErjuoVGdGhIRCSt3z7YIdGpIRCSc+odTpDKuPgIRkbDqPDmYTKeGRERCaWyeoaDuRQAKAhGRQAU9qhgUBCIigTrZIlAQiIiEU1du5tHmGgWBiEgodQ+NMqsmSnlZcF/HU/pkM6s1s0ju53PN7Bozi+a3NBGRmS97r+LgOoph6i2CR4EqM2sDvgvcDDyQr6JERMKia3A00EtHYepBYO4eB94O3O3uvw1ckL+yRETCoZRaBGZmlwE3Av+Ve64sPyWJiIRH1+BooBPOwdSD4HbgTuDr7v60mS0HHslfWSIiM18ilaF/JBV4i2BKt8Nx9x8DPwbIdRp3ufv781mYiMhMFyuCwWQw9auGvmxmDWZWC+wEnjGzP8lvaSIiM1tXEUwvAVM/NbTK3fuB3wS+BSwje+XQaZnZ/WZ2wsx2nuZ1M7NPmtluM9tuZpecUeUiIiWuqwgmnIOpB0E0N27gN4FN7p4E/GXe8wBw1SSvXw2szD02Ap+ZYi0iIjNC9+DYqaHSaBH8M7AfqAUeNbMlQP9kb3D3R4HYJKtcCzzoWT8Hmsxs/hTrEREpeccHRoAS6SNw90+6e5u7vyX3xX0AeP1ZfnYbcGjcckfuuZcws41m1m5m7Z2dnWf5sSIixWHLgR6WtdTSUBXsRA1T7SxuNLOPj30Zm9k/kG0dFIS73+Pu6919fWtra6E+VkQkb1LpDL/YG+OyFbODLmXKp4buBwaAd+Ye/cDnzvKzDwOLxi0vzD0nIjLj7TzSz8BoitcUQRBMaRwBsMLd3zFu+a/NbNtZfvYm4FYz+wpwKdDn7kfPcpsiIiXhZ3u6AHj18tIJgmEze627PwZgZpcDw5O9wcz+FbgCaDGzDuAvgSiAu38WeBh4C7AbiAPveSW/gIhIKXp8Tzfnza2nJeArhmDqQfAHwINm1phb7gFumewN7v6ul3ndgfdN8fNFRGaM0VSaJ/fHuOFVi4MuBZj6FBNPAWvNrCG33G9mtwPb81mciMhMtO1gLyPJTFH0D8AZ3qHM3ftzI4wB/mce6hERmfF+tqebiMGlRdA/AGd3q0qbtipERELk8T3dXNjWSGN1cdzo8WyC4OWmmBARkVPEEym2HuopivEDYybtIzCzASb+wjegOi8ViYjMYO37e0imndesaAm6lJMmDQJ3ry9UISIiYfCzPd2UR4xXLZ0VdCknnc2pIREROUOP7+ni4sVN1FRM9er9/FMQiIgUyMBIkh2H+7isSK4WGqMgEBEpkM0Hesh48Vw2OkZBICJSIE/si1EeMS5e3BR0KS+iIBARKZAn9sVYvbCxqPoHQEEgIlIQI8k0T3X0smFZc9ClvISCQESkALYe7CWZdi5VEIiIhNMT+2KYwbolCgIRkVB6Yn83vzKvoWjmFxpPQSAikmeJVIbNB3qKsn8AFAQiInm380gfI8lMUfYPgIJARCTvntgXA+BVCgIRkXB6Yl+MFa21RXF/4okoCERE8iidcZ7cH2PDsuKaVmI8BYGISB7tOjbAwEiqaPsHQEEgIpJX7QeKu38AFAQiInm1t3OI+spyFjRWBV3KaSkIRETy6GAszqLmGsws6FJOS0EgIpJHB2NxFjfXBF3GpBQEIiJ5ksk4h2JxFs9WEIiIhFLn4CijqQyL1CIQEQmng7E4gE4NiYiE1cFuBYGISKgdjMUxg7am6qBLmZSCQEQkTw7F4ixorKaivLi/aou7OhGREpYdQ1DcrQHIcxCY2VVmtsvMdpvZByd4/d1m1mlm23KP9+azHhGRQiqFMQQA5fnasJmVAZ8G3gR0AE+a2SZ3f+aUVb/q7rfmqw4RkSAMJ9KcGBgtiSDIZ4tgA7Db3fe6ewL4CnBtHj9PRKRodPRkrxgq9jEEkN8gaAMOjVvuyD13qneY2XYze8jMFk20ITPbaGbtZtbe2dmZj1pFRKZVqYwhgOA7i/8fsNTd1wDfAz4/0Urufo+7r3f39a2trQUtUETklVAQZB0Gxv+FvzD33Enu3u3uo7nFe4F1eaxHRKRgDsbi1FaU0VxbEXQpLyufQfAksNLMlplZBXADsGn8CmY2f9ziNcCzeaxHRKRgDpXA9NNj8nbVkLunzOxW4DtAGXC/uz9tZn8DtLv7JuD9ZnYNkAJiwLvzVY+ISCEdjMVZOrs26DKmJG9BAODuDwMPn/Lch8f9fCdwZz5rEBEpNHfnYCzOr64sjT7NoDuLRURmnM7BUUaSmaK/D8EYBYGIyDQ7FCudMQSgIBARmXaldOkoKAhERKbdwe7hkph+eoyCQERkmh2MxZnXUEVVtCzoUqZEQSAiMs3GxhCUCgWBiMg0SqUz7O0aKpn+AVAQiIhMG3fnQ1/fQdfgKL92bmmMIQAFgYjItPn77+7i39o7eP8bzuFtaxcEXc6UKQhERKbB5366j08/sod3bVjEB950btDlnJG8TjEhIjITZTLOex54kj2dg5RHjLKIsadziDevmsvfXnthSUw0N56CQETkDP3o+RP8+PlOrjivlYaqKOmM82vnzuFPrzqP8rLSO9GiIBAROUOf++l+5jZU8i+/u55oCX7xn6r0fwMRkQLafWKQn7zQxc2vXjIjQgAUBCIiZ+TBx/dTURbhhg2Lgy5l2igIRESmqH8kyUObO3jb2gW01FUGXc60URCIiEzRv7d3EE+kefdrlgZdyrRSEIiITEEm4zz4+H7WL5nF6oWNQZczrRQEIiIvYzSV5jM/3sOB7ji3zLDWAOjyURGR00qkMvxb+yHufmQ3R/pGeO05LVx14bygy5p2CgIRkQn0jyR5x90/44UTg1yyuImPXreG157TUnKjhqdCQSAicgp35y++sZO9XUN89qZ1XHnB3BkZAGPURyAicoqvbz3MN7cd4bY3ruSqC+fN6BAABYGIyIvs7xriL76xkw1Lm3nf688JupyCUBCIiOQk0xlu+8pWyiLGP95wEWWRmd0SGKM+AhERsreY/LOHtvNURx9333gJbU3VQZdUMAoCEQm9RCrD7V/dysM7jnHHm87lLavnB11SQSkIRCTURpJp/vCLm3lkVyd//tZf4b2vWx50SQWnIBCRUBpJpvnuM8e577F9bO/o5e9+60JuvHRJ0GUFQkEgIqFypHeYT3z/eR7ecYzB0RTzG6v4xPUXce1FbUGXFhgFgYiExon+Ed71Lz/nRP8ob10zn7df3Marl88mEpKrg05HQSAiodAbT3DzfU/QOTDKl37/Ui5ZPCvokoqGguAM9Y8keeH4AM8c6eeZo/30DSf5wK+fy8q59UGXJiKnMTia4pbPPcm+7iEeePerFAKnyGsQmNlVwF1AGXCvu3/klNcrgQeBdUA3cL27789nTWfqUCzO3393F3s7hzgYi9M3nDz5WlNNlEzGeeS5Tj7yjtWhPsdY7Nyd0VSGwdEUDVVRKso1ljIsugdH+cMvbmHn4T4+e9M6XnNOS9AlFZ28BYGZlQGfBt4EdABPmtkmd39m3Gq/B/S4+zlmdgPwUeD6fNV0pkaSaf77FzZzoHuIdUubWbuokcXNNSxvqWPVggbmN1ZxYmCUW7+8hdu+so0n98e4Zm0b7QdibN7fw6GeOK9b2crb1i5g7cLGaZmvJJPx057PTKUzHOsf4UjvCEd6hwForInSVB1ldm0lcxsrqSwvO7l+OuMc7hnmxMAIc+qrmNdYNekXZM9Qgo6eYToHR+gaSNA/kqShOkpzTQWzais4p7WOxproWf+OqXSGF04MsuNwHwMjKQAMGE1l6OiJc6hnmI5YnLqqcs6fV8958xpYOaeO1vpKmmsraKyOsqdzkJ/u7uKx3d3s6OilfyRFOuMAlEeMZS21nDevnpVz6lnQVMWCpmrmNVZhQN9wkr7hJAMjKeKJFPFEmuFkmpa6SlbNb+CcOXVURctO/wuUkj174B/+Ab74RRgchLo6uOkmuOMOWLEi6OrOWvv+GLd+eSuxeIJPXH8Rb1o1N+iSipK5e342bHYZ8FfufmVu+U4Ad/8/49b5Tm6dx82sHDgGtPokRa1fv97b29vzUvOpPvi17XzlyUPc/+71vOH80x9AyXSGj31nF/c8uvfkc8tba1nQWM0T+2Ik0hkWNVfzOxuWcMtrllBT8cv8dXe2HOxl68Ee9nUNsb97iM6BUeY2VLFwVg0LZ1XTP5Jk17EBdh0b4Fj/CK11lbTNqqatqZp0xjnaN8KxvhFODIyQmeQ/pxkn3xsfTbOve4hEKvOi11vqKlk4q5pFs2pY3FxDfVU5Tx/pZ9uhXg7G4pPur4jBhW2NXH5OC+sWz6K6ooyIGWZwtG+Y544O8NyxAQ73DlNbWU5DVTkN1VEiZowm0yTSGXriSZ472s/ouLrGa6qJsrg5t1+GUzx7tJ/uocRpa1o5p471S5tpro1SW1lObUU5JwZGsvvz+ACHYsOT/k4TKYsY57TWsXphI2sXNrJ6YRMZdw7F4hzojnOkd5jeeJLe4QS98SSV5RFa6iqzj/oKWusqmdNQxZz6SirKI6QzfvKR8ewxkXanbzhJ58AoJwZGGRhJ0lgdZVZNBbNqKljaUsuq+Q1UV5xFIH3rW3DddZBMZh9jotHs46GH4OqrX/n2A+Tu3PfYPj7yredom1XN3TdewgULZtZdxc6UmW129/UTvpbHILgOuMrd35tbvhm41N1vHbfOztw6HbnlPbl1uk7Z1kZgI8DixYvXHThwIC81j/fv7Yf4k4e2877Xr+BPrjx/Su9p3x+jJ55k3ZJZNNdWANm/Lr/79DG+vvUwP9vTTUtdJbe+fgW/dclCvrXjKJ9//ADPHu0HoKGqnGWtdcypr+RE/wgdPcN0DyWIlhkrWus4f149C2fVcGJghMO9wxzuGaYsYsxvzP41O7+xiramahbkHhGD3uEkvfEEXYMJjuTec7h3mJqKMpa31rG8pZa5DVV0Do5ypHc4u07vMAdjcY70jpDOOAsaq1i7qIm1i5pY3lJLa332S62hKkr/SJLYUILYUIJth3r52Z4uth7sJTVBIlWURVgxp47FzdUMJzP0DyfpH0mCQ0V5hMryCLWV5aya38DqhY1c2NaYvUF4blNlZUZd5UsbsZ0Do+zpHKRnKEEsnqBnKMH8xmpeu7KFuQ1Vk/43G0mmOdY3wtG+EY72DRMxo7E6SkN1OfVVUWoqyqipKKcqGuFo3wjPHu3n2aP9PH2knx0dfROGUGt9Jc01FbntREmkM3QNjNI9NEr3YGLCfTOZaO73Ht+qgWwgrZxTx6/Mb2B2bQVNNVEaaypY3lLL6oWNNFRN0jrbswfWrIH4JOFeUwPbt5dMy2Akmebxvd18/5nj/ODZExzrH+HKC+bysd9eO/m+CImSD4LxCtEieOZIP791909Zt2QWX/i9S6dt4qnNB2L832/v4hf7YpiBO5w/r55bXrOUN6+aS3NtxUtOH8UTKaJlEaJlhT+nnUpnz6k31VSc0fuGRlM8d2yAVDpDxiHjTmt9JctaagP5PfLF3TnSN8KOjj7KI8aS2TUsaq6Z9LRRJuP0xBOcyP2ln0xlKCszyswoixgRMyIGlguk1vpKmqqjRCKGu9M/kiI2lOCF4wPsONzH9o4+Xjg+QO9wkngi/aLPWt5ay7lz6imLGI6TyUAqkyGRdm568KO84bFNlKdTp/8Fo1HYuBE+9anp2mXTpmcowVMdvew83Meu44PsOtbP3s4hUhmnpqKMX13ZylvWzOdta+bP+CmkpyqoICjJU0PpjHP1XY/SG0/yX+9/Ha31ldO6fXfnsd1d/GhXJ29eNZcNy5p1oMq0GE2l6Y0nef74AE8d6uWpjj72dg4CnDxFVx6JUFEe4ct//GZqRiY/1QcwWlPHvf+5lZ6hBEf7si3RwdEUbU3VLG6uYcnsGs6bV8/qtsZJ/2BwdxLpDNFIZMI+rkzGSWWcjGdPkaXSzmg6TTLt9A8n2dM5yJ4TQ+zuHGRHRy/7u39Z+6Lmas6bW8/KufVsWNbMZctnz5w+nGk0WRDk86qhJ4GVZrYMOAzcAPzOKetsAm4BHgeuA344WQgUwn9uP8Lzxwf59O9cMu0hANm/9F63spXXrWyd9m1LuFWWlzG3oYy5DVUvf3z90dT6RqLxIT72nV1URSMsaMyecpzXUEVHb5wtB3tOduZD9gt5RWsdiVQm28GeSDM4mmJgJMngaOpk/1VZxCjPhUE6FwBTYQZtTdWsmt/AO1+1iIsWNbG6rZF6nfY5a3kLAndPmdmtwHfIXj56v7s/bWZ/A7S7+ybgPuALZrYbiJENi8CkM85dP3iB8+fVc/UMvEG1yEl1dTAw8LKrWUM9u/73VVSURV7ScnV3euJJnj3az/aOPnYe7uNgLE5VNEJ9VTlzGyqpq4xSX1VOXWU51RVlpNJOMp0hmc6AZa/gKjMjkguHSG45WhYhWh6hsixCTWUZy1vqWNZSe3ad43JaeR1H4O4PAw+f8tyHx/08Avx2Pms4E5ueOszeziE+c+MloR9yLjPcTTfBvfe++GqhU0Wj2M03v+iS4/HMjObaCi4/p4XLdW1+SZs5PXdnKZXO8Mkf7Ob8efVceYFaAzLD3XFHtjN4MtEofOADhalHAqUgyPnmtiPs6xri9l8/V60BmflWrMiOE6ipeWkgRKPZ5x96qGQuHZWzoyAg2xr4px++wKr5DVx5gUYeSkhcfXV2nMDGjdDQAJFI9t+NG7PPl+hgMjlzoZ50Lp1xvr3zGJ/98R72d8e55+Z1upRTwmXFiuw4gSIcKyCFE8ogcHe+ue0In/j+8+zvjrOspZaPXbdG85CISCiFLgiGE2n+/Bs7+dqWDi5Y0MDdN17ClRfMm7bRwyIipSZUQbC3c5D/8aUt7Do+wPvfuJLb3rhSASAioReaIPjx852870tbiJYZD7xnA792rkb2iohAiIJgcXMNlyyZxUfevpoFTdVBlyMiUjRCEwTLWmp58L9tCLoMEZGio3EEIiIhpyAQEQk5BYGISMgpCEREQk5BICIScgoCEZGQUxCIiIScgkBEJOQs4HvFnzEz6wQOvMK3twBd01jOTKH9MjHtl4lpv0ys2PfLEnefcG6dkguCs2Fm7e6+Pug6io32y8S0Xyam/TKxUt4vOjUkIhJyCgIRkZALWxDcE3QBRUr7ZWLaLxPTfplYye6XUPURiIjIS4WtRSAiIqdQEIiIhFxogsDMrjKzXWa228w+GHQ9QTGzRWb2iJk9Y2ZPm9ltueebzex7ZvZC7t9ZQdcaBDMrM7OtZvafueVlZvaL3HHzVTOrCLrGQjOzJjN7yMyeM7NnzewyHS9gZh/I/T+008z+1cyqSvV4CUUQmFkZ8GngamAV8C4zWxVsVYFJAXe4+yrg1cD7cvvig8AP3H0l8IPcchjdBjw7bvmjwD+6+zlAD/B7gVQVrLuAb7v7+cBasvsn1MeLmbUB7wfWu/uFQBlwAyV6vIQiCIANwG533+vuCeArwLUB1xQIdz/q7ltyPw+Q/Z+6jez++Hxutc8DvxlMhcExs4XAW4F7c8sGvAF4KLdK6PaLmTUCvwrcB+DuCXfvRccLZG/1W21m5UANcJQSPV7CEgRtwKFxyx2550LNzJYCFwO/AOa6+9HcS8eAuQGVFaRPAH8KZHLLs4Fed0/llsN43CwDOoHP5U6Z3WtmtYT8eHH3w8DfAwfJBkAfsJkSPV7CEgRyCjOrA74G3O7u/eNf8+w1xaG6rtjMfgM44e6bg66lyJQDlwCfcfeLgSFOOQ0U0uNlFtlW0TJgAVALXBVoUWchLEFwGFg0bnlh7rlQMrMo2RD4krv/R+7p42Y2P/f6fOBEUPUF5HLgGjPbT/bU4RvInhtvyjX9IZzHTQfQ4e6/yC0/RDYYwn68/Dqwz9073T0J/AfZY6gkj5ewBMGTwMpcj34F2U6dTQHXFIjcee/7gGfd/ePjXtoE3JL7+Rbgm4WuLUjufqe7L3T3pWSPjx+6+43AI8B1udXCuF+OAYfM7LzcU28EniHkxwvZU0KvNrOa3P9TY/ulJI+X0IwsNrO3kD0HXAbc7+5/F3BJgTCz1wI/AXbwy3PhHyLbT/BvwGKy03y/091jgRQZMDO7Avhjd/8NM1tOtoXQDGwFbnL30SDrKzQzu4hsB3oFsBd4D9k/IkN9vJjZXwPXk70SbyvwXrJ9AiV3vIQmCEREZGJhOTUkIiKnoSAQEQk5BYGISMgpCEREQk5BICIScgoCmZHMbPAM179ibMbRPNVTaWbfN7NtZnb9Ka89YGbXnfLcUjMbzq3/jJk9mBsIKDLtFAQihXExgLtf5O5fneJ79rj7RcBqsqNU35mv4iTcFAQyo+X+0v/RuPn0v5QbCTp2j4rnzGwL8PZx76k1s/vN7IncRGvX5p6/y8w+nPv5SjN71Mwip3xes5l9w8y2m9nPzWyNmc0Bvgi8KvcX/ooz+R3cPQ08QW4CMzO7IFfbttznrDyLXSSiIJBQuBi4ney9KJYDl5tZFfAvwNuAdcC8cev/L7JTTGwAXg98LDfj5p3A9Wb2euCTwHvcPcOL/TWw1d3XkB2x/aC7nyA76vQnuRbBnjMpPlfrpcC3c0/9AXBXrrWwnux8QCKvmIJAwuAJd+/IfWlvA5YC55OdNOyF3OyZXxy3/puBD5rZNuBHQBWw2N3jwO8D3wM+dZov9NcCX1Q7yxIAAAE4SURBVABw9x8Cs82s4RXWvSJXw3HgqLtvzz3/OPAhM/szYIm7D7/C7YsACgIJh/FzvaTJTq08GQPekfvr/SJ3X+zuY3ctWw10k516ON/G+ghWAOvM7BoAd/8ycA0wDDxsZm8oQC0ygykIJKyeA5aOO1//rnGvfQf4o3F9CRfn/l0C3EH2VNPVZnbpBNv9CXBjbv0rgK5T7/dwpty9i+w9AO7MbXc5sNfdP0l2dss1Z7N9EQWBhJK7jwAbgf/KdRaPn0//b4EosN3Mngb+dtz03X/s7kfI3ov23tz5+/H+iuxf79uBj/DLqZpfzj+bWUfu8fgEr38DqDGz15G9emhn7rTRhcCDU/wMkQlp9lERkZBTi0BEJOQUBCIiIacgEBEJOQWBiEjIKQhEREJOQSAiEnIKAhGRkPv/Jr6XHQUc66UAAAAASUVORK5CYII=\n","text/plain":["<Figure size 432x288 with 1 Axes>"]},"metadata":{"tags":[],"needs_background":"light"}},{"output_type":"display_data","data":{"image/png":"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\n","text/plain":["<Figure size 432x288 with 1 Axes>"]},"metadata":{"tags":[],"needs_background":"light"}},{"output_type":"stream","text":["Learning rate: 0.004365158322401656\n"],"name":"stdout"}]},{"cell_type":"markdown","metadata":{"id":"3f6yZ7PeGxxl","colab_type":"text"},"source":["Train the network."]},{"cell_type":"code","metadata":{"id":"421dYBJsHIMz","colab_type":"code","outputId":"94d271ee-f561-40e6-9fc4-88739e8f8795","executionInfo":{"status":"ok","timestamp":1589671205105,"user_tz":-120,"elapsed":2343246,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":1000}},"source":["save_model = SaveModelCallback(learn, every=\"improvement\", monitor=\"accuracy\",\n","                               mode=\"max\", name=\"best\")\n","learn.fit_one_cycle(50, max_lr=learning_rate, callbacks=[save_model])\n","print(\"Training completed\")"],"execution_count":0,"outputs":[{"output_type":"display_data","data":{"text/html":["<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: left;\">\n","      <th>epoch</th>\n","      <th>train_loss</th>\n","      <th>valid_loss</th>\n","      <th>accuracy</th>\n","      <th>time</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <td>0</td>\n","      <td>3.220483</td>\n","      <td>2.502279</td>\n","      <td>0.215278</td>\n","      <td>02:14</td>\n","    </tr>\n","    <tr>\n","      <td>1</td>\n","      <td>2.721853</td>\n","      <td>1.970672</td>\n","      <td>0.513889</td>\n","      <td>00:45</td>\n","    </tr>\n","    <tr>\n","      <td>2</td>\n","      <td>2.102808</td>\n","      <td>1.546296</td>\n","      <td>0.611111</td>\n","      <td>00:46</td>\n","    </tr>\n","    <tr>\n","      <td>3</td>\n","      <td>1.529572</td>\n","      <td>1.299061</td>\n","      <td>0.652778</td>\n","      <td>00:45</td>\n","    </tr>\n","    <tr>\n","      <td>4</td>\n","      <td>1.083635</td>\n","      <td>1.227770</td>\n","      <td>0.649306</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>5</td>\n","      <td>0.753670</td>\n","      <td>1.196534</td>\n","      <td>0.656250</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>6</td>\n","      <td>0.553486</td>\n","      <td>1.234956</td>\n","      <td>0.677083</td>\n","      <td>00:45</td>\n","    </tr>\n","    <tr>\n","      <td>7</td>\n","      <td>0.469860</td>\n","      <td>1.305974</td>\n","      <td>0.638889</td>\n","      <td>00:45</td>\n","    </tr>\n","    <tr>\n","      <td>8</td>\n","      <td>0.439078</td>\n","      <td>1.467183</td>\n","      <td>0.611111</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>9</td>\n","      <td>0.444947</td>\n","      <td>1.460294</td>\n","      <td>0.659722</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>10</td>\n","      <td>0.523674</td>\n","      <td>1.512085</td>\n","      <td>0.628472</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>11</td>\n","      <td>0.643836</td>\n","      <td>1.818254</td>\n","      <td>0.579861</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>12</td>\n","      <td>0.785472</td>\n","      <td>1.529551</td>\n","      <td>0.631944</td>\n","      <td>00:43</td>\n","    </tr>\n","    <tr>\n","      <td>13</td>\n","      <td>0.920099</td>\n","      <td>2.153219</td>\n","      <td>0.579861</td>\n","      <td>00:43</td>\n","    </tr>\n","    <tr>\n","      <td>14</td>\n","      <td>0.981935</td>\n","      <td>1.886610</td>\n","      <td>0.625000</td>\n","      <td>00:42</td>\n","    </tr>\n","    <tr>\n","      <td>15</td>\n","      <td>0.961058</td>\n","      <td>2.116254</td>\n","      <td>0.597222</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>16</td>\n","      <td>0.960422</td>\n","      <td>1.676676</td>\n","      <td>0.635417</td>\n","      <td>00:45</td>\n","    </tr>\n","    <tr>\n","      <td>17</td>\n","      <td>0.997066</td>\n","      <td>1.962970</td>\n","      <td>0.600694</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>18</td>\n","      <td>0.985745</td>\n","      <td>1.727163</td>\n","      <td>0.649306</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>19</td>\n","      <td>0.921910</td>\n","      <td>1.657020</td>\n","      <td>0.645833</td>\n","      <td>00:43</td>\n","    </tr>\n","    <tr>\n","      <td>20</td>\n","      <td>0.904379</td>\n","      <td>1.701344</td>\n","      <td>0.638889</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>21</td>\n","      <td>0.886494</td>\n","      <td>1.637972</td>\n","      <td>0.649306</td>\n","      <td>00:45</td>\n","    </tr>\n","    <tr>\n","      <td>22</td>\n","      <td>0.855149</td>\n","      <td>1.817837</td>\n","      <td>0.638889</td>\n","      <td>00:47</td>\n","    </tr>\n","    <tr>\n","      <td>23</td>\n","      <td>0.746689</td>\n","      <td>1.792092</td>\n","      <td>0.638889</td>\n","      <td>00:47</td>\n","    </tr>\n","    <tr>\n","      <td>24</td>\n","      <td>0.714490</td>\n","      <td>1.769499</td>\n","      <td>0.642361</td>\n","      <td>00:46</td>\n","    </tr>\n","    <tr>\n","      <td>25</td>\n","      <td>0.657042</td>\n","      <td>1.678218</td>\n","      <td>0.666667</td>\n","      <td>00:46</td>\n","    </tr>\n","    <tr>\n","      <td>26</td>\n","      <td>0.691134</td>\n","      <td>1.836248</td>\n","      <td>0.642361</td>\n","      <td>00:46</td>\n","    </tr>\n","    <tr>\n","      <td>27</td>\n","      <td>0.687079</td>\n","      <td>1.725269</td>\n","      <td>0.670139</td>\n","      <td>00:46</td>\n","    </tr>\n","    <tr>\n","      <td>28</td>\n","      <td>0.597107</td>\n","      <td>1.656432</td>\n","      <td>0.673611</td>\n","      <td>00:46</td>\n","    </tr>\n","    <tr>\n","      <td>29</td>\n","      <td>0.571024</td>\n","      <td>1.649623</td>\n","      <td>0.673611</td>\n","      <td>00:45</td>\n","    </tr>\n","    <tr>\n","      <td>30</td>\n","      <td>0.546521</td>\n","      <td>1.519618</td>\n","      <td>0.687500</td>\n","      <td>00:45</td>\n","    </tr>\n","    <tr>\n","      <td>31</td>\n","      <td>0.509624</td>\n","      <td>1.580838</td>\n","      <td>0.680556</td>\n","      <td>00:45</td>\n","    </tr>\n","    <tr>\n","      <td>32</td>\n","      <td>0.488406</td>\n","      <td>1.684045</td>\n","      <td>0.697917</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>33</td>\n","      <td>0.462130</td>\n","      <td>1.669606</td>\n","      <td>0.673611</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>34</td>\n","      <td>0.412501</td>\n","      <td>1.675442</td>\n","      <td>0.673611</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>35</td>\n","      <td>0.393057</td>\n","      <td>1.691648</td>\n","      <td>0.680556</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>36</td>\n","      <td>0.396559</td>\n","      <td>1.714096</td>\n","      <td>0.673611</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>37</td>\n","      <td>0.365956</td>\n","      <td>1.681871</td>\n","      <td>0.670139</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>38</td>\n","      <td>0.325198</td>\n","      <td>1.652823</td>\n","      <td>0.680556</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>39</td>\n","      <td>0.317553</td>\n","      <td>1.675324</td>\n","      <td>0.673611</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>40</td>\n","      <td>0.300847</td>\n","      <td>1.679629</td>\n","      <td>0.673611</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>41</td>\n","      <td>0.266876</td>\n","      <td>1.670971</td>\n","      <td>0.666667</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>42</td>\n","      <td>0.261758</td>\n","      <td>1.690859</td>\n","      <td>0.670139</td>\n","      <td>00:43</td>\n","    </tr>\n","    <tr>\n","      <td>43</td>\n","      <td>0.267113</td>\n","      <td>1.694667</td>\n","      <td>0.666667</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>44</td>\n","      <td>0.252150</td>\n","      <td>1.670507</td>\n","      <td>0.673611</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>45</td>\n","      <td>0.250807</td>\n","      <td>1.658394</td>\n","      <td>0.684028</td>\n","      <td>00:43</td>\n","    </tr>\n","    <tr>\n","      <td>46</td>\n","      <td>0.249311</td>\n","      <td>1.683523</td>\n","      <td>0.670139</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>47</td>\n","      <td>0.241515</td>\n","      <td>1.680516</td>\n","      <td>0.680556</td>\n","      <td>00:44</td>\n","    </tr>\n","    <tr>\n","      <td>48</td>\n","      <td>0.223195</td>\n","      <td>1.681870</td>\n","      <td>0.663194</td>\n","      <td>00:45</td>\n","    </tr>\n","    <tr>\n","      <td>49</td>\n","      <td>0.208988</td>\n","      <td>1.671484</td>\n","      <td>0.673611</td>\n","      <td>00:45</td>\n","    </tr>\n","  </tbody>\n","</table>"],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["Better model found at epoch 0 with accuracy value: 0.2152777761220932.\n","Better model found at epoch 1 with accuracy value: 0.5138888955116272.\n","Better model found at epoch 2 with accuracy value: 0.6111111044883728.\n","Better model found at epoch 3 with accuracy value: 0.6527777910232544.\n","Better model found at epoch 5 with accuracy value: 0.65625.\n","Better model found at epoch 6 with accuracy value: 0.6770833134651184.\n","Better model found at epoch 30 with accuracy value: 0.6875.\n","Better model found at epoch 32 with accuracy value: 0.6979166865348816.\n","Training completed\n"],"name":"stdout"}]},{"cell_type":"markdown","metadata":{"id":"OM7Zy8-teOsj","colab_type":"text"},"source":["## Unfreezing and fine-tuning"]},{"cell_type":"markdown","metadata":{"id":"pWW1PX4oebRo","colab_type":"text"},"source":["In this section, we unfreeze the convolutional layers and fine-tune the whole model."]},{"cell_type":"code","metadata":{"id":"K6iBeH5reSJu","colab_type":"code","colab":{}},"source":["# Load the best model from the previous stage of training\n","learn.load(\"best\")\n","learn.unfreeze()"],"execution_count":0,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"i8ED1y09eyng","colab_type":"text"},"source":["Study the learning rate trend to appropriately set a range of values for the fine tuning process."]},{"cell_type":"code","metadata":{"id":"Q_Y3_xU7e_W4","colab_type":"code","outputId":"bc6aff05-dbb7-4046-b4cf-4f4b92883d07","executionInfo":{"status":"ok","timestamp":1589709890173,"user_tz":-120,"elapsed":67192,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":405}},"source":["learn.lr_find()\n","learn.recorder.plot()"],"execution_count":0,"outputs":[{"output_type":"display_data","data":{"text/html":["\n","    <div>\n","        <style>\n","            /* Turns off some styling */\n","            progress {\n","                /* gets rid of default border in Firefox and Opera. */\n","                border: none;\n","                /* Needs to be in here for Safari polyfill so background images work as expected. */\n","                background-size: auto;\n","            }\n","            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {\n","                background: #F44336;\n","            }\n","        </style>\n","      <progress value='1' class='' max='3' style='width:300px; height:20px; vertical-align: middle;'></progress>\n","      33.33% [1/3 00:50<01:41]\n","    </div>\n","    \n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: left;\">\n","      <th>epoch</th>\n","      <th>train_loss</th>\n","      <th>valid_loss</th>\n","      <th>accuracy</th>\n","      <th>time</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <td>0</td>\n","      <td>0.431189</td>\n","      <td>#na#</td>\n","      <td>00:50</td>\n","    </tr>\n","  </tbody>\n","</table><p>\n","\n","    <div>\n","        <style>\n","            /* Turns off some styling */\n","            progress {\n","                /* gets rid of default border in Firefox and Opera. */\n","                border: none;\n","                /* Needs to be in here for Safari polyfill so background images work as expected. */\n","                background-size: auto;\n","            }\n","            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {\n","                background: #F44336;\n","            }\n","        </style>\n","      <progress value='10' class='' max='46' style='width:300px; height:20px; vertical-align: middle;'></progress>\n","      21.74% [10/46 00:12<00:44 1.0187]\n","    </div>\n","    "],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["LR Finder is complete, type {learner_name}.recorder.plot() to see the graph.\n"],"name":"stdout"},{"output_type":"display_data","data":{"image/png":"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\n","text/plain":["<Figure size 432x288 with 1 Axes>"]},"metadata":{"tags":[],"needs_background":"light"}}]},{"cell_type":"markdown","metadata":{"id":"GT1cXvDyh_T3","colab_type":"text"},"source":["Unfreeze the layers and train the network with a learning rate ranging from 1e-6 (for the first layer) to 1e-2 (for the last layer).\n","\n","Adjust early stopping settings before fine tuning (fine tuning requires less epochs)."]},{"cell_type":"code","metadata":{"id":"A8DtZI3XiTxa","colab_type":"code","outputId":"d8d4af7f-1f5b-4a9f-e403-2e19a8665908","executionInfo":{"status":"ok","timestamp":1589713045524,"user_tz":-120,"elapsed":3040938,"user":{"displayName":"JASON RAVAGLI","photoUrl":"","userId":"01884994422007125599"}},"colab":{"base_uri":"https://localhost:8080/","height":1000}},"source":["save_model = SaveModelCallback(learn, every=\"improvement\", monitor=\"accuracy\",\n","                               mode=\"max\", name=\"best-fine-tuning\")\n","\n","learn.fit_one_cycle(50, max_lr=slice(5e-6,9e-6), callbacks=[save_model])\n","print(\"Fine tuning completed\")"],"execution_count":0,"outputs":[{"output_type":"display_data","data":{"text/html":["<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: left;\">\n","      <th>epoch</th>\n","      <th>train_loss</th>\n","      <th>valid_loss</th>\n","      <th>accuracy</th>\n","      <th>time</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <td>0</td>\n","      <td>0.392495</td>\n","      <td>1.585187</td>\n","      <td>0.697917</td>\n","      <td>02:09</td>\n","    </tr>\n","    <tr>\n","      <td>1</td>\n","      <td>0.376742</td>\n","      <td>1.578793</td>\n","      <td>0.701389</td>\n","      <td>00:59</td>\n","    </tr>\n","    <tr>\n","      <td>2</td>\n","      <td>0.382482</td>\n","      <td>1.601176</td>\n","      <td>0.701389</td>\n","      <td>01:00</td>\n","    </tr>\n","    <tr>\n","      <td>3</td>\n","      <td>0.401182</td>\n","      <td>1.596431</td>\n","      <td>0.711806</td>\n","      <td>00:57</td>\n","    </tr>\n","    <tr>\n","      <td>4</td>\n","      <td>0.389718</td>\n","      <td>1.594447</td>\n","      <td>0.697917</td>\n","      <td>01:00</td>\n","    </tr>\n","    <tr>\n","      <td>5</td>\n","      <td>0.375560</td>\n","      <td>1.583256</td>\n","      <td>0.704861</td>\n","      <td>00:57</td>\n","    </tr>\n","    <tr>\n","      <td>6</td>\n","      <td>0.349609</td>\n","      <td>1.535173</td>\n","      <td>0.701389</td>\n","      <td>00:57</td>\n","    </tr>\n","    <tr>\n","      <td>7</td>\n","      <td>0.339623</td>\n","      <td>1.558284</td>\n","      <td>0.708333</td>\n","      <td>00:58</td>\n","    </tr>\n","    <tr>\n","      <td>8</td>\n","      <td>0.324572</td>\n","      <td>1.496003</td>\n","      <td>0.694444</td>\n","      <td>00:57</td>\n","    </tr>\n","    <tr>\n","      <td>9</td>\n","      <td>0.304771</td>\n","      <td>1.505167</td>\n","      <td>0.694444</td>\n","      <td>00:58</td>\n","    </tr>\n","    <tr>\n","      <td>10</td>\n","      <td>0.322147</td>\n","      <td>1.514399</td>\n","      <td>0.704861</td>\n","      <td>00:57</td>\n","    </tr>\n","    <tr>\n","      <td>11</td>\n","      <td>0.302705</td>\n","      <td>1.493578</td>\n","      <td>0.704861</td>\n","      <td>00:59</td>\n","    </tr>\n","    <tr>\n","      <td>12</td>\n","      <td>0.272916</td>\n","      <td>1.523783</td>\n","      <td>0.697917</td>\n","      <td>00:58</td>\n","    </tr>\n","    <tr>\n","      <td>13</td>\n","      <td>0.277521</td>\n","      <td>1.574941</td>\n","      <td>0.697917</td>\n","      <td>00:59</td>\n","    </tr>\n","    <tr>\n","      <td>14</td>\n","      <td>0.244477</td>\n","      <td>1.541167</td>\n","      <td>0.697917</td>\n","      <td>00:58</td>\n","    </tr>\n","    <tr>\n","      <td>15</td>\n","      <td>0.229686</td>\n","      <td>1.536728</td>\n","      <td>0.701389</td>\n","      <td>01:01</td>\n","    </tr>\n","    <tr>\n","      <td>16</td>\n","      <td>0.217767</td>\n","      <td>1.520039</td>\n","      <td>0.708333</td>\n","      <td>01:00</td>\n","    </tr>\n","    <tr>\n","      <td>17</td>\n","      <td>0.217591</td>\n","      <td>1.512540</td>\n","      <td>0.708333</td>\n","      <td>01:00</td>\n","    </tr>\n","    <tr>\n","      <td>18</td>\n","      <td>0.178585</td>\n","      <td>1.559262</td>\n","      <td>0.694444</td>\n","      <td>01:00</td>\n","    </tr>\n","    <tr>\n","      <td>19</td>\n","      <td>0.182271</td>\n","      <td>1.562128</td>\n","      <td>0.697917</td>\n","      <td>00:59</td>\n","    </tr>\n","    <tr>\n","      <td>20</td>\n","      <td>0.153268</td>\n","      <td>1.585138</td>\n","      <td>0.704861</td>\n","      <td>00:59</td>\n","    </tr>\n","    <tr>\n","      <td>21</td>\n","      <td>0.149888</td>\n","      <td>1.575427</td>\n","      <td>0.697917</td>\n","      <td>00:58</td>\n","    </tr>\n","    <tr>\n","      <td>22</td>\n","      <td>0.165949</td>\n","      <td>1.539685</td>\n","      <td>0.718750</td>\n","      <td>01:00</td>\n","    </tr>\n","    <tr>\n","      <td>23</td>\n","      <td>0.140298</td>\n","      <td>1.551440</td>\n","      <td>0.694444</td>\n","      <td>01:00</td>\n","    </tr>\n","    <tr>\n","      <td>24</td>\n","      <td>0.165977</td>\n","      <td>1.547557</td>\n","      <td>0.715278</td>\n","      <td>00:59</td>\n","    </tr>\n","    <tr>\n","      <td>25</td>\n","      <td>0.160878</td>\n","      <td>1.557118</td>\n","      <td>0.690972</td>\n","      <td>00:59</td>\n","    </tr>\n","    <tr>\n","      <td>26</td>\n","      <td>0.134018</td>\n","      <td>1.556787</td>\n","      <td>0.708333</td>\n","      <td>00:59</td>\n","    </tr>\n","    <tr>\n","      <td>27</td>\n","      <td>0.122426</td>\n","      <td>1.538450</td>\n","      <td>0.708333</td>\n","      <td>00:58</td>\n","    </tr>\n","    <tr>\n","      <td>28</td>\n","      <td>0.128586</td>\n","      <td>1.579115</td>\n","      <td>0.718750</td>\n","      <td>00:58</td>\n","    </tr>\n","    <tr>\n","      <td>29</td>\n","      <td>0.127894</td>\n","      <td>1.550612</td>\n","      <td>0.697917</td>\n","      <td>01:00</td>\n","    </tr>\n","    <tr>\n","      <td>30</td>\n","      <td>0.121558</td>\n","      <td>1.537802</td>\n","      <td>0.708333</td>\n","      <td>01:00</td>\n","    </tr>\n","    <tr>\n","      <td>31</td>\n","      <td>0.112199</td>\n","      <td>1.560686</td>\n","      <td>0.704861</td>\n","      <td>00:59</td>\n","    </tr>\n","    <tr>\n","      <td>32</td>\n","      <td>0.108968</td>\n","      <td>1.555489</td>\n","      <td>0.711806</td>\n","      <td>00:59</td>\n","    </tr>\n","    <tr>\n","      <td>33</td>\n","      <td>0.105380</td>\n","      <td>1.548007</td>\n","      <td>0.690972</td>\n","      <td>01:00</td>\n","    </tr>\n","    <tr>\n","      <td>34</td>\n","      <td>0.109086</td>\n","      <td>1.536335</td>\n","      <td>0.697917</td>\n","      <td>01:00</td>\n","    </tr>\n","    <tr>\n","      <td>35</td>\n","      <td>0.111687</td>\n","      <td>1.568551</td>\n","      <td>0.704861</td>\n","      <td>00:58</td>\n","    </tr>\n","    <tr>\n","      <td>36</td>\n","      <td>0.110312</td>\n","      <td>1.536826</td>\n","      <td>0.701389</td>\n","      <td>00:59</td>\n","    </tr>\n","    <tr>\n","      <td>37</td>\n","      <td>0.105371</td>\n","      <td>1.553579</td>\n","      <td>0.697917</td>\n","      <td>01:00</td>\n","    </tr>\n","    <tr>\n","      <td>38</td>\n","      <td>0.095224</td>\n","      <td>1.532098</td>\n","      <td>0.708333</td>\n","      <td>00:58</td>\n","    </tr>\n","    <tr>\n","      <td>39</td>\n","      <td>0.084577</td>\n","      <td>1.558741</td>\n","      <td>0.708333</td>\n","      <td>00:58</td>\n","    </tr>\n","    <tr>\n","      <td>40</td>\n","      <td>0.084175</td>\n","      <td>1.537789</td>\n","      <td>0.701389</td>\n","      <td>00:59</td>\n","    </tr>\n","    <tr>\n","      <td>41</td>\n","      <td>0.091119</td>\n","      <td>1.531669</td>\n","      <td>0.697917</td>\n","      <td>01:00</td>\n","    </tr>\n","    <tr>\n","      <td>42</td>\n","      <td>0.093745</td>\n","      <td>1.535661</td>\n","      <td>0.701389</td>\n","      <td>00:58</td>\n","    </tr>\n","    <tr>\n","      <td>43</td>\n","      <td>0.096767</td>\n","      <td>1.536002</td>\n","      <td>0.697917</td>\n","      <td>00:59</td>\n","    </tr>\n","    <tr>\n","      <td>44</td>\n","      <td>0.087549</td>\n","      <td>1.535083</td>\n","      <td>0.701389</td>\n","      <td>00:57</td>\n","    </tr>\n","    <tr>\n","      <td>45</td>\n","      <td>0.093166</td>\n","      <td>1.568169</td>\n","      <td>0.687500</td>\n","      <td>00:58</td>\n","    </tr>\n","    <tr>\n","      <td>46</td>\n","      <td>0.097284</td>\n","      <td>1.556991</td>\n","      <td>0.708333</td>\n","      <td>00:58</td>\n","    </tr>\n","    <tr>\n","      <td>47</td>\n","      <td>0.085180</td>\n","      <td>1.558955</td>\n","      <td>0.704861</td>\n","      <td>00:58</td>\n","    </tr>\n","    <tr>\n","      <td>48</td>\n","      <td>0.092046</td>\n","      <td>1.568830</td>\n","      <td>0.704861</td>\n","      <td>00:59</td>\n","    </tr>\n","    <tr>\n","      <td>49</td>\n","      <td>0.077380</td>\n","      <td>1.541601</td>\n","      <td>0.704861</td>\n","      <td>00:58</td>\n","    </tr>\n","  </tbody>\n","</table>"],"text/plain":["<IPython.core.display.HTML object>"]},"metadata":{"tags":[]}},{"output_type":"stream","text":["Better model found at epoch 0 with accuracy value: 0.6979166865348816.\n","Better model found at epoch 1 with accuracy value: 0.7013888955116272.\n","Better model found at epoch 3 with accuracy value: 0.7118055820465088.\n","Better model found at epoch 22 with accuracy value: 0.71875.\n","Fine tuning completed\n"],"name":"stdout"}]}]}